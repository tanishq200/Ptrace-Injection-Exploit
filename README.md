# Ptrace Injection Exploit

## Overview

This document outlines the development and execution of an exploit using the `ptrace` system call to inject and execute custom shellcode within a running process on a Linux system. The exploit targets a specific challenge binary to demonstrate privilege escalation and unauthorized data access.

## Technical Details

- **Target Architecture**: amd64-64-little
- **Security Features**:
  - Partial RELRO
  - Stack Canary
  - NX Enabled
  - No PIE
  - SHSTK Enabled
  - IBT Enabled

## Exploit Overview

The exploit leverages the `ptrace` system call to attach to a child process created by the target binary, inject shellcode into its memory, and execute it. This approach allows the exploit to bypass normal security checks and execute with the privileges of the attached process.

## Exploit Steps

1. **Process Attachment**: Use `ptrace` with `PTRACE_ATTACH` to attach to the child process created by the target binary.
2. **Memory Manipulation**: After stopping the child process, the exploit writes shellcode directly into the text segment of the child process using `PTRACE_POKETEXT`.
3. **Process Detachment**: Once the shellcode is injected, the exploit detaches from the process using `PTRACE_DETACH`, allowing the child process to resume execution.
4. **Shellcode Execution**: The shellcode executed within the context of the child process escalates privileges and performs unauthorized actions, such as reading sensitive files.

## Shellcode Functionality

- **Privilege Escalation**: Utilizes `setreuid(0,0)` to escalate privileges to root.
- **Data Access**: Executes a command to read and display the contents of a sensitive file, typically demonstrating access to restricted data.

## Security Implications

This exploit demonstrates significant security risks associated with insufficiently secured inter-process communication and process control mechanisms in Linux environments. It highlights the necessity for robust security policies, including proper configuration of security features like SELinux or AppArmor, regular updates, and strict privilege separation.

## Recommendations

- **Restrict ptrace**: Limit `ptrace` capabilities using Yama or similar security modules.
- **Enhanced Monitoring**: Implement monitoring solutions to detect and respond to unauthorized process attachments or memory modifications.
- **Security Audits**: Regularly audit system and application configurations to identify and mitigate potential security vulnerabilities.

## Conclusion

The ptrace injection exploit provides a stark reminder of the importance of comprehensive security strategies in protecting systems from sophisticated attacks. By understanding and mitigating such attack vectors, system administrators and security professionals can significantly enhance the security posture of their environments.
